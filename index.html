<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinetaro - Bob's Burgers (Token Edition)</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Architects+Daughter&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-yellow: #FEE76D; --accent-red: #F0262A; --louise-green: #95D244;
            --chalkboard-bg: #2D2926; --font-main: 'Quicksand', sans-serif;
            --font-logo: 'Luckiest Guy', cursive; --font-chalk: 'Architects Daughter', cursive;
        }
        body { margin: 0; background: #1a1a1a; color: white; font-family: var(--font-main); }
        .app-container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: var(--font-logo); color: var(--primary-yellow); text-shadow: 3px 3px 0 var(--accent-red); font-size: 3rem; margin: 0; }
        .player-wrapper { width: 100%; max-width: 1000px; background: var(--chalkboard-bg); border: 6px solid #444; border-radius: 12px; overflow: hidden; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .controls { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; background: #222; border-top: 4px solid var(--accent-red); }
        @media (min-width: 800px) { .controls { grid-template-columns: 250px 1fr; } }
        .control-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px dashed #555; }
        select, button { width: 100%; padding: 10px; background: #333; color: white; border: 2px solid var(--louise-green); border-radius: 6px; cursor: pointer; margin-top: 5px; }
        .episode-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 8px; max-height: 300px; overflow-y: auto; }
        .ep-btn { background: #444; padding: 10px; text-align: center; border-radius: 4px; cursor: pointer; font-family: var(--font-logo); transition: 0.2s; }
        .ep-btn.active { background: var(--primary-yellow); color: #000; transform: scale(1.1); box-shadow: 0 0 10px var(--primary-yellow); }
        .ep-btn.watched { opacity: 0.5; border-color: #111; }
        .status-pill { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-family: var(--font-chalk); margin-top: 10px; }
        .online { background: #1b4332; color: #95d244; }
        .offline { background: #432818; color: #ffab00; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>BOB'S BURGERS</h1>
            <div id="status-pill" class="status-pill offline">Checking Connection...</div>
        </header>

        <main class="player-wrapper">
            <div class="video-container">
                <iframe id="main-player" allowfullscreen src=""></iframe>
            </div>

            <div class="controls">
                <div class="side-panel">
                    <div class="control-card">
                        <label>Season</label>
                        <select id="season-select" onchange="window.loadSeason(this.value)"></select>
                    </div>
                    <div class="control-card">
                        <label>Server</label>
                        <select id="server-select" onchange="window.updatePlayer()">
                            <option value="https://vidsrc.to/embed/tv/">Server 1 (VidSrc.to)</option>
                            <option value="https://vidsrc.me/embed/tv/">Server 2 (VidSrc.me)</option>
                        </select>
                    </div>
                    <button onclick="window.navEpisode(1)" style="background: var(--accent-red); border: none; font-family: var(--font-logo);">NEXT EPISODE</button>
                    <button onclick="window.clearHistory()" style="background: #111; border: 1px solid #333; font-size: 0.7rem; margin-top: 10px;">Reset History</button>
                </div>

                <div class="control-card">
                    <label>Order Up: Episode List</label>
                    <div id="episode-list" class="episode-grid"></div>
                </div>
            </div>
        </main>
    </div>

<script>
    // CREDENTIALS
    const AUTH_TOKEN = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhZGQ4MWU1MTE1M2Q5NmEyZjlkN2IyMDIzOTQzYTM4YiIsIm5iZiI6MTc2Njg0MzA1Ni40ODMsInN1YiI6IjY5NGZlMmIwMGIxNmM5YjlmOTE1NTRhYiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.lddAuSSLW6ceK93h7cv2DXT7B92fspSKR9Bxah9TRmY";
    const TMDB_ID = 32726;

    let state = {
        s: 1,
        e: 1,
        watched: JSON.parse(localStorage.getItem('bobs_watched')) || []
    };

    // Helper for Authenticated Fetch
    async function tmdbFetch(endpoint) {
        const response = await fetch(`https://api.themoviedb.org/3${endpoint}`, {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: `Bearer ${AUTH_TOKEN}` // Recommended Bearer authentication
            }
        });
        if (!response.ok) throw new Error("API Auth Failed");
        return response.json();
    }

    async function init() {
        const status = document.getElementById('status-pill');
        const select = document.getElementById('season-select');

        try {
            const data = await tmdbFetch(`/tv/${TMDB_ID}`);
            status.innerText = "● TMDB TOKEN ACTIVE";
            status.className = "status-pill online";
            
            select.innerHTML = data.seasons
                .filter(s => s.season_number > 0)
                .map(s => `<option value="${s.season_number}">Season ${s.season_number}</option>`).join('');
        } catch (err) {
            status.innerText = "● USING BACKUP LIST";
            status.className = "status-pill offline";
            let options = "";
            for(let i=1; i<=15; i++) options += `<option value="${i}">Season ${i}</option>`;
            select.innerHTML = options;
        }
        window.loadSeason(state.s, state.e);
    }

    window.loadSeason = async function(sNum, activeEp = 1) {
        state.s = sNum;
        const grid = document.getElementById('episode-list');
        grid.innerHTML = "Fetching...";

        try {
            const data = await tmdbFetch(`/tv/${TMDB_ID}/season/${sNum}`);
            renderEpisodes(data.episodes.length, activeEp);
        } catch (err) {
            renderEpisodes(22, activeEp); // Backup: default to 22 episodes
        }
    }

    function renderEpisodes(count, active) {
        const grid = document.getElementById('episode-list');
        grid.innerHTML = "";
        for (let i = 1; i <= count; i++) {
            const btn = document.createElement('div');
            const id = `s${state.s}e${i}`;
            btn.className = `ep-btn ${state.watched.includes(id) ? 'watched' : ''} ${i == active ? 'active' : ''}`;
            btn.innerText = i;
            btn.onclick = () => window.playEpisode(i);
            grid.appendChild(btn);
        }
        window.playEpisode(active);
    }

    window.playEpisode = function(eNum) {
        state.e = eNum;
        const id = `s${state.s}e${eNum}`;
        if (!state.watched.includes(id)) state.watched.push(id);
        
        localStorage.setItem('bobs_watched', JSON.stringify(state.watched));
        window.updatePlayer();

        // UI Updates
        document.querySelectorAll('.ep-btn').forEach((b, idx) => {
            b.classList.toggle('active', (idx + 1) == eNum);
            if ((idx + 1) == eNum) b.classList.add('watched');
        });
    }

    window.updatePlayer = function() {
        const server = document.getElementById('server-select').value;
        document.getElementById('main-player').src = `${server}${TMDB_ID}/${state.s}/${state.e}`;
    }

    window.navEpisode = (dir) => {
        let next = parseInt(state.e) + dir;
        if (next >= 1) window.playEpisode(next);
    }

    window.clearHistory = () => {
        if(confirm("Wipe your watched history?")) {
            localStorage.removeItem('bobs_watched');
            location.reload();
        }
    }

    init();
</script>
</body>
</html>
