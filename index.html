<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinetaro - Bob's Burgers</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Architects+Daughter&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-yellow: #FEE76D; --accent-red: #F0262A; --louise-green: #95D244;
            --chalkboard-bg: #2D2926; --font-main: 'Quicksand', sans-serif;
            --font-logo: 'Luckiest Guy', cursive; --font-chalk: 'Architects Daughter', cursive;
        }
        body { margin: 0; background: #1a1a1a; color: white; font-family: var(--font-main); overflow-x: hidden; }
        .app-container { display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: var(--font-logo); color: var(--primary-yellow); text-shadow: 3px 3px 0 var(--accent-red); font-size: 3.5rem; margin: 0; }
        .player-wrapper { width: 100%; max-width: 1000px; background: var(--chalkboard-bg); border: 6px solid #444; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .controls { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; background: #222; border-top: 4px solid var(--accent-red); }
        @media (min-width: 850px) { .controls { grid-template-columns: 280px 1fr; } }
        .control-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px dashed #555; }
        select, button { width: 100%; padding: 12px; background: #333; color: white; border: 2px solid var(--louise-green); border-radius: 6px; cursor: pointer; font-family: var(--font-main); font-weight: 600; margin-top: 5px; }
        .episode-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(55px, 1fr)); gap: 10px; max-height: 350px; overflow-y: auto; padding-right: 5px; }
        .ep-btn { background: #444; padding: 12px 0; text-align: center; border-radius: 4px; cursor: pointer; font-family: var(--font-logo); transition: 0.2s; border: 2px solid transparent; }
        .ep-btn:hover { background: #555; border-color: var(--louise-green); }
        .ep-btn.active { background: var(--primary-yellow); color: #000; transform: scale(1.05); border-color: white; }
        .ep-btn.watched { opacity: 0.5; }
        .status-bar { font-family: var(--font-chalk); font-size: 0.9rem; color: var(--louise-green); margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>BOB'S BURGERS</h1>
            <div id="status-text" class="status-bar">Initializing Grill...</div>
        </header>

        <main class="player-wrapper">
            <div class="video-container">
                <iframe id="main-player" allowfullscreen src=""></iframe>
            </div>

            <div class="controls">
                <div class="side-panel">
                    <div class="control-card">
                        <label style="color:var(--primary-yellow); font-family:var(--font-chalk)">Season</label>
                        <select id="season-select" onchange="window.loadSeason(this.value)"></select>
                    </div>
                    <div class="control-card">
                        <label style="color:var(--primary-yellow); font-family:var(--font-chalk)">Server</label>
                        <select id="server-select" onchange="window.updatePlayer()">
                            <option value="https://vidsrc.to/embed/tv/">Server 1 (VidSrc.to)</option>
                            <option value="https://vidsrc.me/embed/tv/">Server 2 (VidSrc.me)</option>
                        </select>
                    </div>
                    <button onclick="window.navEpisode(1)" style="background:var(--accent-red); border:none; font-family:var(--font-logo); font-size:1.2rem;">NEXT ORDER</button>
                </div>

                <div class="control-card">
                    <label style="color:var(--primary-yellow); font-family:var(--font-chalk); display:block; margin-bottom:10px;">Episode List</label>
                    <div id="episode-list" class="episode-grid"></div>
                </div>
            </div>
        </main>
    </div>

<script>
    // YOUR NEW CREDENTIALS
    const TOKEN = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhZGQ4MWU1MTE1M2Q5NmEyZjlkN2IyMDIzOTQzYTM4YiIsIm5iZiI6MTc2Njg0MzA1Ni40ODMsInN1YiI6IjY5NGZlMmIwMGIxNmM5YjlmOTE1NTRhYiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.lddAuSSLW6ceK93h7cv2DXT7B92fspSKR9Bxah9TRmY";
    const SHOW_ID = 32726;

    let appState = {
        s: 1,
        e: 1,
        watched: JSON.parse(localStorage.getItem('bobs_watched')) || []
    };

    // Correct Auth Fetch using Bearer Token
    async function apiRequest(path) {
        const response = await fetch(`https://api.themoviedb.org/3${path}`, {
            headers: {
                'Authorization': `Bearer ${TOKEN}`,
                'Content-Type': 'application/json'
            }
        });
        if (!response.ok) throw new Error("Auth Failure");
        return response.json();
    }

    async function startApp() {
        const status = document.getElementById('status-text');
        const seasonMenu = document.getElementById('season-select');

        try {
            const data = await apiRequest(`/tv/${SHOW_ID}`);
            status.innerText = "Grill is Hot: TMDB Connected";
            
            seasonMenu.innerHTML = data.seasons
                .filter(s => s.season_number > 0)
                .map(s => `<option value="${s.season_number}">Season ${s.season_number}</option>`).join('');
            
            // Sync current season to menu
            seasonMenu.value = appState.s;
        } catch (err) {
            status.innerText = "Grill is Cold: Using Backup Season List";
            let backup = "";
            for(let i=1; i<=15; i++) backup += `<option value="${i}">Season ${i}</option>`;
            seasonMenu.innerHTML = backup;
        }
        window.loadSeason(appState.s, appState.e);
    }

    window.loadSeason = async function(sNum, activeEp = 1) {
        appState.s = sNum;
        const grid = document.getElementById('episode-list');
        grid.innerHTML = "<div style='grid-column: 1/-1; text-align:center;'>Preparing Ingredients...</div>";

        try {
            const data = await apiRequest(`/tv/${SHOW_ID}/season/${sNum}`);
            renderGrid(data.episodes.length, activeEp);
        } catch (err) {
            renderGrid(22, activeEp); // Backup episode count
        }
    }

    function renderGrid(count, active) {
        const grid = document.getElementById('episode-list');
        grid.innerHTML = "";
        for (let i = 1; i <= count; i++) {
            const btn = document.createElement('div');
            const key = `s${appState.s}e${i}`;
            btn.className = `ep-btn ${appState.watched.includes(key) ? 'watched' : ''} ${i == active ? 'active' : ''}`;
            btn.innerText = i;
            btn.onclick = () => window.play(i);
            grid.appendChild(btn);
        }
        window.play(active);
    }

    window.play = function(eNum) {
        appState.e = eNum;
        const key = `s${appState.s}e${eNum}`;
        if (!appState.watched.includes(key)) appState.watched.push(key);
        
        localStorage.setItem('bobs_watched', JSON.stringify(appState.watched));
        window.updatePlayer();

        document.querySelectorAll('.ep-btn').forEach((btn, index) => {
            btn.classList.toggle('active', (index + 1) == eNum);
            if ((index + 1) == eNum) btn.classList.add('watched');
        });
    }

    window.updatePlayer = function() {
        const serverBase = document.getElementById('server-select').value;
        document.getElementById('main-player').src = `${serverBase}${SHOW_ID}/${appState.s}/${appState.e}`;
    }

    window.navEpisode = (direction) => {
        window.play(parseInt(appState.e) + direction);
    }

    startApp();
</script>
</body>
</html>
